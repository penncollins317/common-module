buildscript {
    apply from: 'dependencies.gradle'
    repositories {
        maven { url 'https://maven.aliyun.com/repository/public' }
    }
}


subprojects {
    apply plugin: 'java'
    apply plugin: 'java-library'
    sourceCompatibility = project_jdk
    targetCompatibility = project_jdk

    dependencies {
        compileOnly libraries.'lombok'
        annotationProcessor libraries.'lombok'
        testImplementation libraries.'spring-boot-starter-test'
    }

    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/public/' }
        maven { url 'https://repo.spring.io/milestone/' }
        maven { url 'https://repo.spring.io/snapshot' }
        mavenCentral()
    }

    tasks.withType(JavaCompile) {
        options.encoding = 'UTF-8'
    }
}

project("common") {
    dependencies {
        api libraries.'spring-boot-starter-mail'
        api libraries.'spring-boot-starter-validation'
        api libraries.'jackson-annotations'
        implementation libraries.'fastjson2'
        implementation(libraries.'java-sms-sdk') {
            exclude module: 'commons-logging'
        }

        implementation libraries.'spring-web'
        implementation libraries.'spring-webmvc'
        implementation libraries.'spring-core'
        implementation libraries.'spring-aop'
        api libraries.'jackson-databind'
        implementation libraries.'spring-security-core'
        implementation libraries.'jackson-dataformat-xml'
        api(libraries.'easyexcel') {
            exclude module: 'java-jaxb'
            exclude module: 'jaxb-core'
        }
        api libraries.'jaxb-core'
        implementation libraries.'servlet-api'
        implementation 'com.google.zxing:core:3.5.2'
        implementation 'com.google.zxing:javase:3.5.2'
        api libraries.'mybatis-plus'
        api libraries.'mybatis-spring'
        annotationProcessor libraries.'spring-boot-configuration-processor'
    }
}

project("security") {
    dependencies {
        api 'com.nimbusds:nimbus-jose-jwt:10.0.1'
        api 'org.springframework.security:spring-security-oauth2-resource-server:6.4.2'
        api 'org.springframework.security:spring-security-oauth2-jose:6.4.2'
        api 'org.springframework.security:spring-security-oauth2-client:6.4.2'
        api libraries.'spring-boot-starter-security'
        api libraries.'spring-boot-starter-web'
        api libraries.'spring-boot-starter-jdbc'
        implementation project(":common")
        implementation libraries.'spring-boot-starter-thymeleaf'
        annotationProcessor libraries.'spring-boot-configuration-processor'
    }
}


project("security-apikeys") {
    dependencies {
        implementation project(":common")
        api project(":security")
        implementation libraries.'servlet-api'
    }
}


project("ai-chat") {
    dependencies {
        implementation project(":security")
        implementation project(":common")
        implementation libraries.'mybatis-plus-spring-boot3-starter'
        implementation libraries.'spring-boot-starter-web'
        implementation libraries.'postgresql'
        implementation platform("org.springframework.ai:spring-ai-bom:1.0.0-SNAPSHOT")
        implementation 'org.springframework.ai:spring-ai-openai-spring-boot-starter'
    }
}

project("oss") {
    dependencies {
        api libraries.'aliyun-sdk-oss'
        api libraries.'qiniu-java-sdk'
        api libraries.'minio'
        api libraries.'s3'
        implementation libraries.'spring-boot-starter-thymeleaf'
        implementation libraries.'spring-boot-starter-web'
        implementation libraries.'spring-boot-starter-data-redis'
        annotationProcessor libraries.'spring-boot-configuration-processor'
        implementation project(":common")
        implementation project(":security")
    }
}

project("starter") {
    dependencies {
        implementation project(":common")
        implementation project(":security")
        implementation project(":security-apikeys")
        implementation project(":oss")
        implementation libraries.'postgresql'
        implementation libraries.'spring-boot-starter-web'
        implementation 'com.baomidou:mybatis-plus-spring-boot3-starter:3.5.9'
    }
}